{% extends 'base.html' %}
{% load static %}

{% block content %}
<section class="breadcrumbs">
    <div class="container">
        <div class="d-flex justify-content-between align-items-center">
            <h2>My Dashboard</h2>
            <ol>
                <li><a href="{% url 'home' %}">Home</a></li>
                <li>Dashboard</li>
            </ol>
        </div>
    </div>
</section>

<section class="section">
    <div class="container">

        <div class="row mb-4">
            <div class="col-md-4">
                <div class="card border-0 shadow-sm"
                    style="background: linear-gradient(45deg, #2eca6a, #26ab5b); color: white;">
                    <div class="card-body p-4">
                        <h5>Current Plan</h5>
                        <h3 class="fw-bold">{{ subscription.package.name|default:"No Plan" }}</h3>
                        <p class="mb-0">Expires: {{ subscription.end_date|date:"M d, Y"|default:"Never" }}</p>
                    </div>
                </div>
            </div>
            <div class="col-md-4">
                <div class="card border-0 shadow-sm">
                    <div class="card-body p-4">
                        <h5>Listing Slots</h5>
                        <div class="d-flex align-items-end justify-content-between">
                            <h2 class="fw-bold text-success mb-0">{{ remaining_slots }}</h2>
                            <span class="text-muted">Available</span>
                        </div>
                        <div class="progress mt-3" style="height: 5px;">
                            <div class="progress-bar bg-success" role="progressbar"
                                style="width: {{ used_slots_pct }}%;"></div>
                        </div>
                        <small class="text-muted mt-2 d-block">{{ used_slots }} used of {{
                            subscription.package.listing_limit|default:0 }} total</small>
                    </div>
                </div>
            </div>
            <div class="col-md-4">
                <div class="card border-0 shadow-sm d-flex align-items-center justify-content-center h-100 p-4">
                    <div class="d-grid gap-2 w-100">
                        <a href="{% url 'listings:post_property' %}" class="btn btn-success btn-lg">
                            <i class="bi bi-plus-circle me-2"></i> Post Property
                        </a>
                        <a href="{% url 'listings:pricing' %}" class="btn btn-outline-success">
                            <i class="bi bi-arrow-up-circle me-2"></i> Upgrade Plan
                        </a>
                    </div>
                </div>
            </div>
        </div>

        <div class="card shadow-sm border-0">
            <div class="card-header bg-white py-3">
                <h5 class="mb-0 fw-bold">My Active Listings</h5>
            </div>
            <div class="card-body p-0">
                <div class="table-responsive">
                    <table class="table table-hover align-middle mb-0">
                        <thead class="bg-light">
                            <tr>
                                <th class="ps-4">Property</th>
                                <th>Status</th>
                                <th>Listing Date</th>
                                <th>Views</th>
                                <th>Price</th>
                                <th class="text-end pe-4">Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for property in properties %}
                            <tr>
                                <td class="ps-4">
                                    <div class="d-flex align-items-center">
                                        <a href="{{ property.get_absolute_url }}"
                                            class="text-decoration-none d-flex align-items-center text-dark">
                                            {% if property.featured_image %}
                                            <img src="{{ property.featured_image.url }}" class="rounded me-3"
                                                style="width: 60px; height: 40px; object-fit: cover;">
                                            {% else %}
                                            <div class="rounded me-3 bg-secondary" style="width: 60px; height: 40px;">
                                            </div>
                                            {% endif %}
                                            <div>
                                                <h6 class="mb-0 text-primary">{{ property.title }}</h6>
                                                <small class="text-muted">{{ property.city.name }}, {{
                                                    property.state.name }}</small>
                                            </div>
                                        </a>
                                    </div>
                                </td>
                                <td>
                                    <span class="badge bg-success bg-opacity-10 text-success">{{
                                        property.status.name|title }}</span>
                                </td>
                                <td>{{ property.created_at|date:"M d, Y" }}</td>
                                <td>{{ property.views_count }}</td>
                                <td>â‚¦{{ property.price|floatformat:2 }}</td>
                                <td class="text-end pe-4">
                                    <a href="#" class="btn btn-sm btn-outline-secondary"><i
                                            class="bi bi-pencil"></i></a>
                                    <a href="{{ property.get_absolute_url }}" class="btn btn-sm btn-outline-primary"><i
                                            class="bi bi-eye"></i></a>
                                </td>
                            </tr>
                            {% empty %}
                            <tr>
                                <td colspan="6" class="text-center py-5 text-muted">
                                    <i class="bi bi-house-dash display-4 mb-3 d-block"></i>
                                    No properties found. Post your first property now!
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

    </div>
</section>
{% endblock %}