{% extends 'base.html' %}
{% load static %}

{% block content %}
<main class="main">

  <!-- Page Title -->
  <div class="page-title">
    <div class="heading">
      <div class="container">
        <div class="row d-flex justify-content-center text-center">
          <div class="col-lg-8">
            <h1 class="heading-title">Contact Us</h1>
            <p class="mb-0">
              Have questions or need assistance? We're here to help! Reach out to us
              and we'll get back to you as soon as possible.
            </p>
          </div>
        </div>
      </div>
    </div>
    <nav class="breadcrumbs">
      <div class="container">
        <ol>
          <li><a href="{% url 'home' %}">Home</a></li>
          <li class="current">Contact</li>
        </ol>
      </div>
    </nav>
  </div><!-- End Page Title -->

  <!-- Display Django Messages -->
  {% if messages %}
  <div class="container mt-4">
    {% for message in messages %}
    <div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
      {{ message }}
      <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    </div>
    {% endfor %}
  </div>
  {% endif %}

  <!-- Contact 2 Section -->
  <section id="contact-2" class="contact-2 section">

    <div class="container" data-aos="fade-up" data-aos-delay="100">

      <!-- Contact Info Boxes -->
      <div class="row gy-4 mb-5">
        <div class="col-lg-4" data-aos="fade-up" data-aos-delay="100">
          <div class="contact-info-box">
            <div class="icon-box">
              <i class="bi bi-geo-alt"></i>
            </div>
            <div class="info-content">
              <h4>Our Address</h4>
              {% if contact_info %}
              <p>{{ contact_info.address_line1 }}</p>
              {% if contact_info.address_line2 %}
              <p>{{ contact_info.address_line2 }}</p>
              {% endif %}
              <p>{{ contact_info.city }}, {{ contact_info.state }} {{ contact_info.postal_code }}</p>
              {% else %}
              <p>1842 Maple Avenue, Portland, Oregon 97204</p>
              {% endif %}
            </div>
          </div>
        </div>

        <div class="col-lg-4" data-aos="fade-up" data-aos-delay="200">
          <div class="contact-info-box">
            <div class="icon-box">
              <i class="bi bi-envelope"></i>
            </div>
            <div class="info-content">
              <h4>Email Address</h4>
              {% if contact_info %}
              <p>{{ contact_info.email }}</p>
              {% if contact_info.support_email %}
              <p>{{ contact_info.support_email }}</p>
              {% endif %}
              {% else %}
              <p>info@example.com</p>
              <p>contact@example.com</p>
              {% endif %}
            </div>
          </div>
        </div>

        <div class="col-lg-4" data-aos="fade-up" data-aos-delay="300">
          <div class="contact-info-box">
            <div class="icon-box">
              <i class="bi bi-headset"></i>
            </div>
            <div class="info-content">
              <h4>Hours of Operation</h4>
              {% if contact_info %}
              <p>Sunday-Friday: {{ contact_info.weekday_hours }}</p>
              <p>Saturday: {{ contact_info.weekend_hours }}</p>
              {% else %}
              <p>Sunday-Fri: 9 AM - 6 PM</p>
              <p>Saturday: 9 AM - 4 PM</p>
              {% endif %}
            </div>
          </div>
        </div>
      </div>

    </div>

    <!-- Google Maps (Full Width) -->
    {% if contact_info and contact_info.google_maps_embed_url %}
    <div class="map-section" data-aos="fade-up" data-aos-delay="200">
      <iframe src="{{ contact_info.google_maps_embed_url }}" width="100%" height="500" style="border:0;"
        allowfullscreen="" loading="lazy" referrerpolicy="no-referrer-when-downgrade"></iframe>
    </div>
    {% endif %}

    <!-- Contact Form Section (Overlapping) -->
    <div class="container form-container-overlap">
      <div class="row justify-content-center" data-aos="fade-up" data-aos-delay="300">
        <div class="col-lg-10">
          <div class="contact-form-wrapper">
            <h2 class="text-center mb-4">Get in Touch</h2>

            <form method="post" action="{% url 'contact' %}" class="contact-form" id="contactForm">
              {% csrf_token %}
              <div class="row g-3">
                <div class="col-md-6">
                  <div class="form-group">
                    <div class="input-with-icon">
                      <i class="bi bi-person"></i>
                      <input type="text" class="form-control" name="name" placeholder="Full Name" required>
                    </div>
                  </div>
                </div>

                <div class="col-md-6">
                  <div class="form-group">
                    <div class="input-with-icon">
                      <i class="bi bi-envelope"></i>
                      <input type="email" class="form-control" name="email" placeholder="Email Address" required>
                    </div>
                  </div>
                </div>

                <div class="col-md-12">
                  <div class="form-group">
                    <div class="input-with-icon">
                      <i class="bi bi-text-left"></i>
                      <input type="text" class="form-control" name="subject" placeholder="Subject" required>
                    </div>
                  </div>
                </div>

                <div class="col-12">
                  <div class="form-group">
                    <div class="input-with-icon">
                      <i class="bi bi-chat-dots message-icon"></i>
                      <textarea class="form-control" name="message" placeholder="Write your message here..."
                        style="height: 180px" required></textarea>
                    </div>
                  </div>
                </div>

                <div class="col-12">
                  <div class="loading" style="display: none;">Sending...</div>
                  <div class="error-message" style="display: none;"></div>
                  <div class="sent-message" style="display: none;">Your message has been sent. Thank you!</div>
                </div>

                <div class="col-12 text-center">
                  <button type="submit" class="btn btn-primary btn-submit">
                    <i class="bi bi-send me-2"></i>SEND MESSAGE
                  </button>
                </div>
              </div>
            </form>
          </div>
        </div>
      </div>

    </div>

  </section><!-- /Contact 2 Section -->

</main>


<!-- Scroll Top -->
<a href="#" id="scroll-top" class="scroll-top d-flex align-items-center justify-content-center"><i
    class="bi bi-arrow-up-short"></i></a>

<!-- Preloader -->
<div id="preloader"></div>

<!-- Vendor JS Files -->
<script src="{% static 'assets/vendor/bootstrap/js/bootstrap.bundle.min.js' %}"></script>
<script src="{% static 'assets/vendor/aos/aos.js' %}"></script>
<script src="{% static 'assets/vendor/purecounter/purecounter_vanilla.js' %}"></script>
<script src="{% static 'assets/vendor/glightbox/js/glightbox.min.js' %}"></script>
<script src="{% static 'assets/vendor/swiper/swiper-bundle.min.js' %}"></script>

<!-- Main JS File -->
<script src="{% static 'assets/js/main.js' %}"></script>

{% endblock content %}

{% block extra_scripts %}
<script>
  document.addEventListener('DOMContentLoaded', function () {
    const contactForm = document.getElementById('contactForm');

    if (contactForm) {
      contactForm.addEventListener('submit', function (e) {
        e.preventDefault();

        // UI Elements
        const loading = this.querySelector('.loading');
        const errorMessage = this.querySelector('.error-message');
        const sentMessage = this.querySelector('.sent-message');
        const submitBtn = this.querySelector('button[type="submit"]');

        // Reset state
        loading.style.display = 'block';
        errorMessage.style.display = 'none';
        sentMessage.style.display = 'none';
        submitBtn.disabled = true;

        // Prepare data
        const formData = new FormData(this);

        // Send request
        fetch("{% url 'contact_ajax' %}", {
          method: 'POST',
          body: formData,
          headers: {
            'X-Requested-With': 'XMLHttpRequest'
          }
        })
          .then(response => response.json())
          .then(data => {
            loading.style.display = 'none';
            submitBtn.disabled = false;

            if (data.success) {
              sentMessage.style.display = 'block';
              sentMessage.innerText = data.message || 'Your message has been sent. Thank you!';
              contactForm.reset();
            } else {
              errorMessage.style.display = 'block';
              errorMessage.innerText = data.message || 'Something went wrong. Please try again.';
            }
          })
          .catch(error => {
            loading.style.display = 'none';
            submitBtn.disabled = false;
            errorMessage.style.display = 'block';
            errorMessage.innerText = 'An error occurred. Please try again later.';
            console.error('Error:', error);
          });
      });
    }
  });
</script>
{% endblock %}