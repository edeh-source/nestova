{% extends 'base.html' %}

{% load static %}
{% load humanize %}

{% block title %}Properties by {{ agent.user.get_full_name|default:agent.user.username }} | Nestova{% endblock %}

{% block content %}

<main class="main">

    <!-- Page Title -->
    <div class="page-title">
        <div class="heading">
            <div class="container">
                <div class="row d-flex justify-content-center text-center">
                    <div class="col-lg-8">
                        <h1 class="heading-title">Properties by {{ agent.user.get_full_name|default:agent.user.username }}</h1>
                        <p class="mb-0">
                            Browse all {{ total_properties }} propert{{ total_properties|pluralize:"y,ies" }} listed by
                            this agent
                        </p>
                    </div>
                </div>
            </div>
        </div>
        <nav class="breadcrumbs">
            <div class="container">
                <ol>
                    <li><a href="{% url 'home' %}">Home</a></li>
                    <li><a href="{% url 'agents:agent_profile' agent.slug %}">{{ agent.user.get_full_name|default:agent.user.username }}</a></li>
                    <li class="current">Properties</li>
                </ol>
            </div>
        </nav>
    </div><!-- End Page Title -->

    <!-- Agent Header -->
    <section class="agent-header-section section">
        <div class="container">
            <div class="agent-header-card" data-aos="fade-up">
                <div class="agent-info-compact">
                    <img src="{% if agent.user.profile_image %}{{ agent.user.profile_image.url }}{% else %}{% static 'assets/img/real-estate/agent-3.webp' %}{% endif %}"
                        alt="{{ agent.user.get_full_name }}" class="agent-thumb">
                    <div class="agent-details">
                        <h3>{{ agent.user.get_full_name|default:agent.user.username }}</h3>
                        <p class="agent-title">Licensed Real Estate Professional</p>
                        {% if agent.verification_status == 'verified' %}
                        <span class="badge bg-success"><i class="bi bi-patch-check-fill"></i> Verified Agent</span>
                        {% endif %}
                    </div>
                </div>
                <div class="agent-actions">
                    <a href="{% url 'agents:agent_profile' agent.slug %}" class="btn btn-outline-primary">
                        <i class="bi bi-person"></i> View Profile
                    </a>
                    {% if agent.user.email %}
                    <a href="mailto:{{ agent.user.email }}" class="btn btn-primary">
                        <i class="bi bi-envelope"></i> Contact Agent
                    </a>
                    {% endif %}
                </div>
            </div>
        </div>
    </section>

    <!-- Properties Section -->
    <section id="properties" class="properties section">
        <div class="container" data-aos="fade-up" data-aos-delay="100">

            {% if properties %}
            <div class="row gy-4">
                {% for property in properties %}
                <div class="col-lg-4 col-md-6" data-aos="fade-up" data-aos-delay="{% cycle '200' '250' '300' %}">
                    <article class="stack-card">
                        <figure class="stack-media">
                            <a href="{{ property.get_absolute_url }}">
                                <img src="{% if property.featured_image %}{{ property.featured_image.url }}{% else %}{% static 'assets/img/real-estate/property-exterior-8.webp' %}{% endif %}"
                                    alt="{{ property.title }}" class="img-fluid" loading="lazy">
                            </a>
                            <figcaption>
                                {% if property.is_exclusive %}
                                <span class="chip exclusive">Exclusive</span>
                                {% elif property.is_hot %}
                                <span class="chip hot">Hot</span>
                                {% elif property.is_new %}
                                <span class="chip new">New</span>
                                {% elif property.is_premium %}
                                <span class="chip premium">Premium</span>
                                {% elif property.is_featured %}
                                <span class="chip featured">Featured</span>
                                {% endif %}
                            </figcaption>
                        </figure>
                        <div class="stack-body">
                            <h5><a href="{{ property.get_absolute_url }}">{{ property.title|truncatewords:7 }}</a></h5>
                            <div class="stack-loc"><i class="bi bi-geo-alt"></i> {{ property.city.name }}, {{ property.state.code }}</div>
                            <ul class="stack-specs">
                                <li><i class="bi bi-door-open"></i> {{ property.bedrooms }}</li>
                                <li><i class="bi bi-droplet"></i> {{ property.bathrooms }}</li>
                                <li><i class="bi bi-aspect-ratio"></i> {{ property.square_feet|floatformat:0|intcomma }}
                                    sq ft</li>
                            </ul>
                            <div class="stack-foot">
                                <span class="stack-price">{{ property.formatted_price }}</span>
                                <a href="{{ property.get_absolute_url }}" class="stack-link">View Details</a>
                            </div>
                        </div>
                    </article>
                </div>
                {% endfor %}
            </div>

            <!-- Pagination -->
            {% if properties.has_other_pages %}
            <div class="pagination-wrapper" data-aos="fade-up" data-aos-delay="400">
                <nav aria-label="Page navigation">
                    <ul class="pagination justify-content-center">
                        {% if properties.has_previous %}
                        <li class="page-item">
                            <a class="page-link" href="?page={{ properties.previous_page_number }}"
                                aria-label="Previous">
                                <span aria-hidden="true">&laquo;</span>
                            </a>
                        </li>
                        {% else %}
                        <li class="page-item disabled">
                            <span class="page-link">&laquo;</span>
                        </li>
                        {% endif %}

                        {% for num in properties.paginator.page_range %}
                        {% if properties.number == num %}
                        <li class="page-item active"><span class="page-link">{{ num }}</span></li>
                        {% elif num > properties.number|add:'-3' and num < properties.number|add:'3' %} <li
                            class="page-item"><a class="page-link" href="?page={{ num }}">{{ num }}</a></li>
                            {% endif %}
                            {% endfor %}

                            {% if properties.has_next %}
                            <li class="page-item">
                                <a class="page-link" href="?page={{ properties.next_page_number }}" aria-label="Next">
                                    <span aria-hidden="true">&raquo;</span>
                                </a>
                            </li>
                            {% else %}
                            <li class="page-item disabled">
                                <span class="page-link">&raquo;</span>
                            </li>
                            {% endif %}
                    </ul>
                </nav>
            </div>
            {% endif %}

            {% else %}
            <div class="text-center py-5">
                <i class="bi bi-house-slash" style="font-size: 4rem; color: #ccc;"></i>
                <h3 class="mt-3">No Properties Found</h3>
                <p class="text-muted">This agent hasn't listed any properties yet.</p>
                <a href="{% url 'home' %}" class="btn btn-primary mt-3">Browse All Properties</a>
            </div>
            {% endif %}

        </div>
    </section><!-- /Properties Section -->

</main>

{% endblock content %}