{% extends 'base.html' %}
{% load static %}
{% load humanize %}

{% block title %}Shop — Premium Real Estate Products | Nestova{% endblock %}

{% block extra_head %}
<style>
/* ============================================================
   SHOP PAGE — LUXURY GLASSMORPHISM DARK DESIGN SYSTEM
   ============================================================ */

/* ---- PAGE HERO ---- */
.shop-hero {
  position: relative;
  margin-top: 80px;
  padding: 90px 0 70px;
  overflow: hidden;
  background: linear-gradient(160deg, #060B1A 0%, #0D1B3E 55%, #0A0A0F 100%);
}

.shop-hero::after {
  content: '';
  position: absolute;
  bottom: 0; left: 0; right: 0;
  height: 1px;
  background: linear-gradient(to right, transparent, rgba(201,168,76,0.3), transparent);
}

/* Ambient orbs */
.shop-hero-orb {
  position: absolute;
  border-radius: 50%;
  filter: blur(120px);
  pointer-events: none;
  animation: orbFloat 12s ease-in-out infinite;
}

.shop-hero-orb.a {
  width: 600px; height: 600px;
  background: rgba(13,27,62,0.6);
  top: -200px; right: -150px;
  animation-delay: 0s;
}

.shop-hero-orb.b {
  width: 400px; height: 400px;
  background: rgba(201,168,76,0.05);
  bottom: -100px; left: -100px;
  animation-delay: -6s;
}

@keyframes orbFloat {
  0%, 100% { transform: translate(0,0) scale(1); }
  33%       { transform: translate(20px,-30px) scale(1.05); }
  66%       { transform: translate(-15px,15px) scale(0.97); }
}

.shop-hero-grain {
  position: absolute; inset: 0;
  background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)' opacity='0.025'/%3E%3C/svg%3E");
  pointer-events: none;
}

.shop-hero-content {
  position: relative;
  z-index: 2;
  text-align: center;
}

.shop-eyebrow {
  display: inline-flex;
  align-items: center;
  gap: 8px;
  padding: 7px 18px;
  border-radius: 50px;
  background: linear-gradient(135deg, rgba(201,168,76,0.15), rgba(201,168,76,0.05));
  border: 1px solid rgba(201,168,76,0.3);
  color: var(--gold);
  font-size: 0.7rem;
  font-weight: 700;
  letter-spacing: 0.2em;
  text-transform: uppercase;
  margin-bottom: 20px;
}

.shop-eyebrow::before {
  content: '';
  width: 5px; height: 5px;
  border-radius: 50%;
  background: var(--gold);
  animation: pulseDot 2s ease-in-out infinite;
}

@keyframes pulseDot {
  0%, 100% { transform: scale(1); opacity: 1; }
  50%       { transform: scale(1.6); opacity: 0.5; }
}

.shop-hero h1 {
  font-family: var(--font-display);
  font-size: clamp(2.2rem, 5vw, 3.8rem);
  font-weight: 300;
  color: #fff;
  line-height: 1.1;
  letter-spacing: -0.5px;
  margin-bottom: 16px;
}

.shop-hero h1 em {
  font-style: italic;
  color: var(--gold-light);
}

.shop-hero p {
  color: rgba(255,255,255,0.45);
  font-size: 1rem;
  max-width: 540px;
  margin: 0 auto 28px;
  line-height: 1.75;
}

.breadcrumbs-glass {
  display: inline-flex;
  align-items: center;
  gap: 8px;
  padding: 9px 20px;
  background: rgba(255,255,255,0.05);
  backdrop-filter: blur(12px);
  border: 1px solid rgba(255,255,255,0.08);
  border-radius: 50px;
  font-size: 0.8rem;
}

.breadcrumbs-glass a { color: rgba(255,255,255,0.45); text-decoration: none; transition: color 0.3s; }
.breadcrumbs-glass a:hover { color: var(--gold-light); }
.breadcrumbs-glass .sep { color: rgba(255,255,255,0.18); font-size: 0.7rem; }
.breadcrumbs-glass .current { color: var(--gold-light); font-weight: 500; }

/* ============================================================
   MAIN LAYOUT
   ============================================================ */
.shop-section {
  padding: 52px 0 100px;
  background: var(--obsidian);
}

/* ============================================================
   SIDEBAR
   ============================================================ */
.shop-sidebar {
  position: sticky;
  top: 100px;
  max-height: calc(100vh - 120px);
  overflow-y: auto;
  scrollbar-width: thin;
  scrollbar-color: rgba(201,168,76,0.3) transparent;
}

.shop-sidebar::-webkit-scrollbar { width: 3px; }
.shop-sidebar::-webkit-scrollbar-track { background: transparent; }
.shop-sidebar::-webkit-scrollbar-thumb { background: rgba(201,168,76,0.3); border-radius: 2px; }

.filter-glass {
  background: rgba(18,18,26,0.85);
  backdrop-filter: blur(24px) saturate(160%);
  -webkit-backdrop-filter: blur(24px) saturate(160%);
  border: 1px solid rgba(255,255,255,0.07);
  border-radius: 20px;
  padding: 28px;
  box-shadow: 0 20px 60px rgba(0,0,0,0.3);
  margin-bottom: 20px;
}

.filter-glass-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  margin-bottom: 22px;
  padding-bottom: 14px;
  border-bottom: 1px solid rgba(255,255,255,0.06);
}

.filter-glass-title {
  font-size: 0.7rem;
  letter-spacing: 0.2em;
  text-transform: uppercase;
  color: var(--gold);
  font-weight: 700;
  display: flex;
  align-items: center;
  gap: 8px;
  margin: 0;
}

.filter-reset-link {
  font-size: 0.74rem;
  color: rgba(255,255,255,0.28);
  text-decoration: none;
  transition: color 0.3s;
}

.filter-reset-link:hover { color: var(--gold-light); }

.filter-section { margin-bottom: 20px; }

.filter-section:last-of-type { margin-bottom: 22px; }

.filter-label {
  display: block;
  font-size: 0.7rem;
  letter-spacing: 0.14em;
  text-transform: uppercase;
  color: rgba(255,255,255,0.35);
  font-weight: 700;
  margin-bottom: 10px;
}

.filter-input,
.filter-select {
  width: 100%;
  background: rgba(255,255,255,0.05);
  border: 1px solid rgba(255,255,255,0.08);
  border-radius: 10px;
  color: rgba(255,255,255,0.8);
  font-family: var(--font-body);
  font-size: 0.88rem;
  padding: 11px 14px;
  outline: none;
  transition: all 0.3s ease;
  -webkit-appearance: none;
}

.filter-input::placeholder { color: rgba(255,255,255,0.2); }

.filter-input:focus,
.filter-select:focus {
  background: rgba(255,255,255,0.08);
  border-color: rgba(201,168,76,0.4);
  box-shadow: 0 0 0 3px rgba(201,168,76,0.08);
  color: #fff;
}

.filter-select option { background: #12121A; color: #fff; }

/* Range inputs */
.range-row { display: flex; gap: 10px; }
.range-row .filter-input { flex: 1; }

/* Pill filter buttons */
.pill-group { display: flex; gap: 6px; flex-wrap: wrap; }

.pill-btn {
  padding: 7px 14px;
  border-radius: 50px;
  font-size: 0.78rem;
  font-weight: 600;
  background: rgba(255,255,255,0.04);
  border: 1px solid rgba(255,255,255,0.08);
  color: rgba(255,255,255,0.5);
  cursor: pointer;
  transition: all 0.25s ease;
  line-height: 1;
}

.pill-btn:hover {
  background: rgba(201,168,76,0.1);
  border-color: rgba(201,168,76,0.28);
  color: var(--gold-light);
}

.pill-btn.active {
  background: linear-gradient(135deg, rgba(201,168,76,0.22), rgba(201,168,76,0.08));
  border-color: rgba(201,168,76,0.48);
  color: var(--gold-light);
  box-shadow: 0 4px 12px rgba(201,168,76,0.12);
}

/* Checkbox */
.check-group { display: flex; flex-direction: column; gap: 10px; }

.check-item { display: flex; align-items: center; gap: 10px; cursor: pointer; }

.check-item input[type="checkbox"] {
  width: 16px; height: 16px;
  background: rgba(255,255,255,0.05);
  border: 1px solid rgba(255,255,255,0.15);
  border-radius: 4px;
  cursor: pointer;
  appearance: none;
  -webkit-appearance: none;
  transition: all 0.25s ease;
  flex-shrink: 0;
  position: relative;
}

.check-item input[type="checkbox"]:checked {
  background: var(--gold);
  border-color: var(--gold);
}

.check-item input[type="checkbox"]:checked::after {
  content: '✓';
  position: absolute;
  top: 50%; left: 50%;
  transform: translate(-50%,-50%);
  color: #0A0A0F;
  font-size: 0.62rem;
  font-weight: 800;
}

.check-item label {
  color: rgba(255,255,255,0.55);
  font-size: 0.86rem;
  cursor: pointer;
  transition: color 0.25s;
}

.check-item:hover label { color: rgba(255,255,255,0.85); }

.btn-filter-apply {
  width: 100%;
  padding: 13px;
  background: linear-gradient(135deg, var(--gold), var(--gold-dark));
  border: none;
  border-radius: 12px;
  color: #0A0A0F;
  font-family: var(--font-body);
  font-weight: 700;
  font-size: 0.88rem;
  letter-spacing: 0.05em;
  cursor: pointer;
  transition: all 0.3s ease;
  position: relative;
  overflow: hidden;
}

.btn-filter-apply::before {
  content: '';
  position: absolute;
  top: 0; left: -100%;
  width: 100%; height: 100%;
  background: linear-gradient(90deg, transparent, rgba(255,255,255,0.22), transparent);
  transition: left 0.5s;
}

.btn-filter-apply:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 24px rgba(201,168,76,0.35);
}

.btn-filter-apply:hover::before { left: 100%; }

/* ============================================================
   TOOLBAR
   ============================================================ */
.shop-toolbar {
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 16px;
  padding: 14px 20px;
  background: rgba(18,18,26,0.75);
  backdrop-filter: blur(20px);
  border: 1px solid rgba(255,255,255,0.07);
  border-radius: 14px;
  margin-bottom: 28px;
  flex-wrap: wrap;
}

.shop-results-count {
  font-size: 0.82rem;
  color: rgba(255,255,255,0.35);
}

.shop-results-count strong { color: var(--gold-light); font-weight: 600; }

.sort-select {
  background: rgba(255,255,255,0.05);
  border: 1px solid rgba(255,255,255,0.08);
  border-radius: 10px;
  color: rgba(255,255,255,0.65);
  font-family: var(--font-body);
  font-size: 0.83rem;
  padding: 9px 14px;
  cursor: pointer;
  outline: none;
  transition: all 0.3s ease;
  -webkit-appearance: none;
  min-width: 180px;
}

.sort-select:focus { border-color: rgba(201,168,76,0.35); color: #fff; }
.sort-select option { background: #12121A; }

/* View toggle */
.view-toggle {
  display: flex;
  gap: 4px;
  background: rgba(255,255,255,0.04);
  padding: 4px;
  border-radius: 10px;
}

.view-btn {
  width: 36px; height: 36px;
  border-radius: 8px;
  background: transparent;
  border: none;
  color: rgba(255,255,255,0.35);
  display: flex; align-items: center; justify-content: center;
  font-size: 0.9rem;
  cursor: pointer;
  transition: all 0.25s ease;
}

.view-btn.active {
  background: rgba(201,168,76,0.15);
  color: var(--gold-light);
}

.view-btn:hover:not(.active) {
  background: rgba(255,255,255,0.07);
  color: rgba(255,255,255,0.7);
}

/* ============================================================
   PRODUCT GRID
   ============================================================ */
.products-grid  { display: block; }
.products-list  { display: none; }
.products-grid.active { display: block; }
.products-list.active { display: block; }

/* Product Card */
.product-card-wrap {
  opacity: 0;
  transform: translateY(22px);
  animation: cardReveal 0.6s cubic-bezier(0.16, 1, 0.3, 1) forwards;
}

.product-card-wrap:nth-child(1) { animation-delay: 0.05s; }
.product-card-wrap:nth-child(2) { animation-delay: 0.10s; }
.product-card-wrap:nth-child(3) { animation-delay: 0.15s; }
.product-card-wrap:nth-child(4) { animation-delay: 0.20s; }
.product-card-wrap:nth-child(5) { animation-delay: 0.25s; }
.product-card-wrap:nth-child(6) { animation-delay: 0.30s; }
.product-card-wrap:nth-child(7) { animation-delay: 0.35s; }
.product-card-wrap:nth-child(8) { animation-delay: 0.40s; }
.product-card-wrap:nth-child(9) { animation-delay: 0.45s; }

@keyframes cardReveal {
  to { opacity: 1; transform: translateY(0); }
}

.product-card {
  background: rgba(18,18,26,0.85);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255,255,255,0.07);
  border-radius: 20px;
  overflow: hidden;
  transition: all 0.45s cubic-bezier(0.175, 0.885, 0.32, 1.275);
  display: flex;
  flex-direction: column;
  height: 100%;
  will-change: transform;
}

.product-card:hover {
  transform: translateY(-10px);
  border-color: rgba(201,168,76,0.2);
  box-shadow: 0 40px 80px rgba(0,0,0,0.5), 0 0 30px rgba(201,168,76,0.07);
}

/* Image */
.product-image-wrapper {
  position: relative;
  height: 260px;
  overflow: hidden;
  flex-shrink: 0;
}

.product-image-wrapper img {
  width: 100%; height: 100%;
  object-fit: cover;
  display: block;
  transition: transform 0.7s cubic-bezier(0.25, 0.46, 0.45, 0.94);
}

.product-card:hover .product-image-wrapper img {
  transform: scale(1.12) rotate(1deg);
}

.product-image-wrapper::after {
  content: '';
  position: absolute;
  inset: 0;
  background: linear-gradient(to top, rgba(10,10,15,0.8) 0%, transparent 55%);
  pointer-events: none;
  z-index: 1;
}

.img-placeholder {
  width: 100%; height: 100%;
  background: rgba(255,255,255,0.02);
  display: flex; align-items: center; justify-content: center;
  font-size: 3rem;
  color: rgba(255,255,255,0.06);
}

/* Badges */
.product-badges {
  position: absolute;
  top: 14px; left: 14px;
  z-index: 3;
  display: flex;
  flex-direction: column;
  gap: 6px;
}

.pbadge {
  display: inline-flex;
  align-items: center;
  gap: 5px;
  padding: 5px 12px;
  border-radius: 50px;
  font-size: 0.68rem;
  font-weight: 700;
  letter-spacing: 0.08em;
  text-transform: uppercase;
  backdrop-filter: blur(10px);
  border: 1px solid transparent;
}

.pbadge.featured {
  background: linear-gradient(135deg, rgba(201,168,76,0.25), rgba(201,168,76,0.08));
  border-color: rgba(201,168,76,0.45);
  color: var(--gold-light);
}

.pbadge.bestseller {
  background: rgba(34,197,94,0.15);
  border-color: rgba(34,197,94,0.35);
  color: #4ade80;
}

.pbadge.discount {
  background: rgba(239,68,68,0.18);
  border-color: rgba(239,68,68,0.35);
  color: #f87171;
  animation: pulseScale 2s ease-in-out infinite;
}

.pbadge.out-of-stock {
  background: rgba(0,0,0,0.5);
  border-color: rgba(255,255,255,0.12);
  color: rgba(255,255,255,0.5);
}

@keyframes pulseScale {
  0%, 100% { transform: scale(1); }
  50% { transform: scale(1.04); }
}

/* Quick actions */
.product-actions {
  position: absolute;
  top: 14px; right: 14px;
  z-index: 3;
  display: flex;
  flex-direction: column;
  gap: 8px;
  opacity: 0;
  transform: translateX(10px);
  transition: all 0.35s ease;
}

.product-card:hover .product-actions {
  opacity: 1;
  transform: translateX(0);
}

.action-btn {
  width: 38px; height: 38px;
  border-radius: 50%;
  background: rgba(10,10,15,0.65);
  backdrop-filter: blur(12px);
  border: 1px solid rgba(255,255,255,0.1);
  color: rgba(255,255,255,0.65);
  display: flex; align-items: center; justify-content: center;
  font-size: 0.88rem;
  cursor: pointer;
  transition: all 0.25s ease;
}

.action-btn:hover {
  background: rgba(201,168,76,0.2);
  border-color: rgba(201,168,76,0.4);
  color: var(--gold-light);
  transform: scale(1.12);
}

.action-btn.wishlisted {
  background: rgba(220,50,50,0.25);
  border-color: rgba(220,50,50,0.45);
  color: #ff6b6b;
}

/* Card body */
.product-card .card-body {
  padding: 22px;
  display: flex;
  flex-direction: column;
  flex: 1;
}

.product-category {
  font-size: 0.68rem;
  letter-spacing: 0.15em;
  text-transform: uppercase;
  color: var(--gold);
  font-weight: 700;
  margin-bottom: 8px;
}

.card-title {
  font-size: 1rem;
  font-weight: 600;
  line-height: 1.45;
  margin-bottom: 8px;
}

.card-title a {
  color: rgba(255,255,255,0.88);
  text-decoration: none;
  transition: color 0.25s;
}

.card-title a:hover { color: var(--gold-light); }

.product-description {
  color: rgba(255,255,255,0.38);
  font-size: 0.84rem;
  line-height: 1.6;
  margin-bottom: 14px;
  display: -webkit-box;
  -webkit-line-clamp: 2;
  -webkit-box-orient: vertical;
  overflow: hidden;
}

/* Star rating */
.star-rating {
  display: flex;
  align-items: center;
  gap: 7px;
  margin-bottom: 14px;
}

.stars { display: flex; gap: 3px; }

.stars i { color: var(--gold); font-size: 0.88rem; }
.stars i.empty { color: rgba(201,168,76,0.2); }

.rating-text {
  color: rgba(255,255,255,0.3);
  font-size: 0.8rem;
}

/* Price section */
.price-section {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 14px 16px;
  background: rgba(255,255,255,0.03);
  border: 1px solid rgba(255,255,255,0.05);
  border-radius: 12px;
  margin-bottom: 16px;
}

.original-price {
  font-size: 0.82rem;
  color: rgba(255,255,255,0.25);
  text-decoration: line-through;
  display: block;
  line-height: 1;
  margin-bottom: 2px;
}

.current-price {
  font-family: var(--font-display);
  font-size: 1.7rem;
  font-weight: 600;
  color: var(--gold-light);
  line-height: 1;
}

.discount-pill {
  padding: 5px 10px;
  border-radius: 50px;
  background: rgba(239,68,68,0.15);
  border: 1px solid rgba(239,68,68,0.3);
  color: #f87171;
  font-size: 0.72rem;
  font-weight: 700;
  white-space: nowrap;
}

/* Add to Cart button */
.cart-btn {
  width: 100%;
  padding: 13px;
  background: rgba(201,168,76,0.1);
  border: 1px solid rgba(201,168,76,0.22);
  border-radius: 12px;
  color: var(--gold-light);
  font-family: var(--font-body);
  font-size: 0.85rem;
  font-weight: 700;
  letter-spacing: 0.04em;
  text-transform: uppercase;
  display: flex; align-items: center; justify-content: center;
  gap: 8px;
  cursor: pointer;
  transition: all 0.3s ease;
  margin-top: auto;
  position: relative;
  overflow: hidden;
}

.cart-btn::before {
  content: '';
  position: absolute;
  top: 50%; left: 50%;
  width: 0; height: 0;
  border-radius: 50%;
  background: rgba(255,255,255,0.12);
  transform: translate(-50%, -50%);
  transition: width 0.5s ease, height 0.5s ease;
}

.cart-btn:hover::before { width: 300px; height: 300px; }

.cart-btn:hover {
  background: linear-gradient(135deg, var(--gold), var(--gold-dark));
  border-color: var(--gold);
  color: #0A0A0F;
  transform: translateY(-2px);
  box-shadow: 0 10px 28px rgba(201,168,76,0.3);
}

.cart-btn:disabled {
  background: rgba(255,255,255,0.04);
  border-color: rgba(255,255,255,0.07);
  color: rgba(255,255,255,0.2);
  cursor: not-allowed;
  transform: none;
  box-shadow: none;
}

.cart-btn i { font-size: 1rem; }

/* ============================================================
   LIST VIEW
   ============================================================ */
.product-list-item {
  background: rgba(18,18,26,0.85);
  backdrop-filter: blur(20px);
  border: 1px solid rgba(255,255,255,0.07);
  border-radius: 18px;
  overflow: hidden;
  margin-bottom: 18px;
  transition: all 0.4s ease;
  opacity: 0;
  animation: cardReveal 0.5s cubic-bezier(0.16, 1, 0.3, 1) forwards;
}

.product-list-item:hover {
  border-color: rgba(201,168,76,0.18);
  box-shadow: 0 24px 60px rgba(0,0,0,0.4);
  transform: translateY(-3px);
}

.product-list-item .product-image-wrapper {
  height: 100%;
  min-height: 200px;
  border-radius: 0;
}

.product-list-item .product-image-wrapper img {
  height: 100%;
  min-height: 200px;
}

/* ============================================================
   EMPTY STATE
   ============================================================ */
.shop-empty {
  text-align: center;
  padding: 80px 40px;
}

.shop-empty-icon {
  width: 80px; height: 80px;
  border-radius: 50%;
  background: rgba(201,168,76,0.07);
  border: 1px solid rgba(201,168,76,0.14);
  display: flex; align-items: center; justify-content: center;
  font-size: 2rem;
  color: var(--gold);
  margin: 0 auto 24px;
}

.shop-empty h3 {
  font-family: var(--font-display);
  font-size: 1.8rem;
  font-weight: 400;
  color: rgba(255,255,255,0.6);
  margin-bottom: 10px;
}

.shop-empty p {
  color: rgba(255,255,255,0.3);
  font-size: 0.95rem;
}

/* ============================================================
   PAGINATION
   ============================================================ */
.shop-pagination {
  display: flex;
  justify-content: center;
  margin-top: 52px;
}

.pagination {
  display: flex;
  gap: 6px;
  list-style: none;
  padding: 0; margin: 0;
  flex-wrap: wrap;
  align-items: center;
}

.page-item .page-link {
  display: flex; align-items: center; justify-content: center;
  width: 44px; height: 44px;
  border-radius: 12px;
  background: rgba(18,18,26,0.8);
  backdrop-filter: blur(16px);
  border: 1px solid rgba(255,255,255,0.07);
  color: rgba(255,255,255,0.45);
  font-size: 0.88rem;
  font-weight: 600;
  text-decoration: none;
  transition: all 0.3s ease;
}

.page-item .page-link:hover {
  background: rgba(201,168,76,0.1);
  border-color: rgba(201,168,76,0.3);
  color: var(--gold-light);
}

.page-item.active .page-link {
  background: linear-gradient(135deg, var(--gold), var(--gold-dark));
  border-color: var(--gold);
  color: #0A0A0F;
  font-weight: 700;
  box-shadow: 0 6px 20px rgba(201,168,76,0.3);
}

.page-item.disabled .page-link {
  opacity: 0.3;
  pointer-events: none;
}

/* ============================================================
   RESPONSIVE
   ============================================================ */
@media (max-width: 1199px) {
  .shop-sidebar { position: static; max-height: none; margin-bottom: 32px; }
}

@media (max-width: 991px) {
  .shop-hero { padding: 70px 0 52px; }
}

@media (max-width: 767px) {
  .product-card:hover { transform: translateY(-6px); }
  .shop-toolbar { flex-direction: column; align-items: flex-start; gap: 12px; }
  .filter-glass { padding: 20px 18px; }
  .product-list-item .product-image-wrapper { min-height: 220px; height: 220px; }
}

@media (max-width: 575px) {
  .shop-hero h1 { font-size: 2rem; }
  .sort-select { width: 100%; min-width: auto; }
}
</style>
{% endblock %}

{% block content %}
<main class="main">

  <!-- ======================== SHOP HERO ======================== -->
  <section class="shop-hero">
    <div class="shop-hero-orb a"></div>
    <div class="shop-hero-orb b"></div>
    <div class="shop-hero-grain"></div>

    <div class="container">
      <div class="shop-hero-content">
        <div class="shop-eyebrow"><i class="bi bi-bag-heart"></i> Nestova Shop</div>
        <h1>Premium Real Estate <em>Essentials</em></h1>
        <p>Curated tools, guides, and accessories to elevate your property journey — from first viewing to final key handover.</p>
        <div class="breadcrumbs-glass">
          <a href="{% url 'home' %}">Home</a>
          <span class="sep"><i class="bi bi-chevron-right"></i></span>
          <span class="current">Shop</span>
        </div>
      </div>
    </div>
  </section>

  <!-- ======================== MAIN SECTION ======================== -->
  <section class="shop-section">
    <div class="container">
      <div class="row">

        <!-- ======================== SIDEBAR ======================== -->
        <div class="col-lg-3">
          <div class="shop-sidebar">
            <div class="filter-glass">
              <div class="filter-glass-header">
                <h5 class="filter-glass-title"><i class="bi bi-sliders"></i> Filter Products</h5>
                <a href="{% url 'shop:product_list' %}" class="filter-reset-link">Clear all</a>
              </div>

              <form method="GET" action="{% url 'shop:product_list' %}">
                <!-- Search -->
                <div class="filter-section">
                  <label class="filter-label">Search</label>
                  <div style="position:relative;">
                    <input type="text" name="q" class="filter-input" placeholder="Search products…" value="{{ request.GET.q|default:'' }}" style="padding-right:40px;">
                    <i class="bi bi-search" style="position:absolute;right:13px;top:50%;transform:translateY(-50%);color:rgba(255,255,255,0.2);font-size:0.88rem;pointer-events:none;"></i>
                  </div>
                </div>

                <!-- Category -->
                <div class="filter-section">
                  <label class="filter-label">Category</label>
                  <select name="category" class="filter-select">
                    <option value="">All Categories</option>
                    {% for cat in categories %}
                    <option value="{{ cat.slug }}" {% if request.GET.category == cat.slug %}selected{% endif %}>{{ cat.name }}</option>
                    {% endfor %}
                  </select>
                </div>

                <!-- Price Range -->
                <div class="filter-section">
                  <label class="filter-label">Price Range (₦)</label>
                  <div class="range-row">
                    <input type="number" name="min_price" class="filter-input" placeholder="Min" value="{{ request.GET.min_price|default:'' }}">
                    <input type="number" name="max_price" class="filter-input" placeholder="Max" value="{{ request.GET.max_price|default:'' }}">
                  </div>
                </div>

                <!-- Sort -->
                <div class="filter-section">
                  <label class="filter-label">Sort By</label>
                  <select name="sort" class="filter-select">
                    <option value="newest"    {% if request.GET.sort == 'newest' %}selected{% endif %}>Newest First</option>
                    <option value="price_asc" {% if request.GET.sort == 'price_asc' %}selected{% endif %}>Price: Low → High</option>
                    <option value="price_desc"{% if request.GET.sort == 'price_desc' %}selected{% endif %}>Price: High → Low</option>
                    <option value="popular"   {% if request.GET.sort == 'popular' %}selected{% endif %}>Most Popular</option>
                  </select>
                </div>

                <!-- Availability -->
                <div class="filter-section">
                  <label class="filter-label">Availability</label>
                  <div class="check-group">
                    <div class="check-item">
                      <input type="checkbox" id="in_stock" name="in_stock" {% if request.GET.in_stock %}checked{% endif %}>
                      <label for="in_stock">In Stock Only</label>
                    </div>
                    <div class="check-item">
                      <input type="checkbox" id="on_sale" name="on_sale" {% if request.GET.on_sale %}checked{% endif %}>
                      <label for="on_sale">On Sale</label>
                    </div>
                    <div class="check-item">
                      <input type="checkbox" id="featured" name="featured" {% if request.GET.featured %}checked{% endif %}>
                      <label for="featured">Featured</label>
                    </div>
                  </div>
                </div>

                <button type="submit" class="btn-filter-apply">
                  <i class="bi bi-search me-2"></i>Apply Filters
                </button>
              </form>
            </div>

            <!-- Categories quick nav -->
            {% if categories %}
            <div class="filter-glass">
              <div class="filter-glass-title" style="margin-bottom:16px;"><i class="bi bi-grid-3x3-gap"></i> Browse Categories</div>
              <div style="display:flex;flex-direction:column;gap:6px;">
                {% for cat in categories %}
                <a href="?category={{ cat.slug }}" style="display:flex;align-items:center;justify-content:space-between;padding:10px 14px;border-radius:10px;background:rgba(255,255,255,0.03);border:1px solid rgba(255,255,255,0.05);text-decoration:none;color:rgba(255,255,255,0.55);font-size:0.86rem;transition:all 0.25s ease;" class="cat-link">
                  <span>{{ cat.name }}</span>
                  {% if cat.product_count %}<span style="background:rgba(201,168,76,0.12);border:1px solid rgba(201,168,76,0.2);color:var(--gold);font-size:0.7rem;font-weight:700;padding:2px 8px;border-radius:50px;">{{ cat.product_count }}</span>{% endif %}
                </a>
                {% endfor %}
              </div>
            </div>
            {% endif %}

          </div>
        </div>

        <!-- ======================== PRODUCTS AREA ======================== -->
        <div class="col-lg-9">

          <!-- Toolbar -->
          <div class="shop-toolbar">
            <div class="shop-results-count">
              Showing <strong>{{ products|length }}</strong> product{{ products|length|pluralize }}
            </div>

            <div class="view-toggle">
              <button class="view-btn active" data-view="grid" title="Grid view"><i class="bi bi-grid-3x3-gap"></i></button>
              <button class="view-btn" data-view="list" title="List view"><i class="bi bi-list-ul"></i></button>
            </div>

            <form method="GET" style="display:inline-flex;align-items:center;gap:8px;">
              {% if request.GET.q %}<input type="hidden" name="q" value="{{ request.GET.q }}">{% endif %}
              {% if request.GET.category %}<input type="hidden" name="category" value="{{ request.GET.category }}">{% endif %}
              {% if request.GET.min_price %}<input type="hidden" name="min_price" value="{{ request.GET.min_price }}">{% endif %}
              {% if request.GET.max_price %}<input type="hidden" name="max_price" value="{{ request.GET.max_price }}">{% endif %}
              <select class="sort-select" name="sort" onchange="this.form.submit()">
                <option value="newest"    {% if request.GET.sort == 'newest' %}selected{% endif %}>Newest First</option>
                <option value="price_asc" {% if request.GET.sort == 'price_asc' %}selected{% endif %}>Price: Low → High</option>
                <option value="price_desc"{% if request.GET.sort == 'price_desc' %}selected{% endif %}>Price: High → Low</option>
                <option value="popular"   {% if request.GET.sort == 'popular' %}selected{% endif %}>Most Popular</option>
              </select>
            </form>
          </div>

          <!-- ---- GRID VIEW ---- -->
          <div class="products-grid active" id="viewGrid">
            <div class="row g-4">
              {% for product in products %}
              <div class="col-lg-4 col-md-6 product-card-wrap">
                <div class="product-card">
                  <!-- Image -->
                  <div class="product-image-wrapper">
                    {% if product.image %}
                    <img src="{{ product.image.url }}" alt="{{ product.name }}" loading="lazy">
                    {% else %}
                    <div class="img-placeholder"><i class="bi bi-bag"></i></div>
                    {% endif %}

                    <!-- Badges -->
                    <div class="product-badges">
                      {% if product.is_featured %}<span class="pbadge featured"><i class="bi bi-star-fill"></i> Featured</span>{% endif %}
                      {% if product.is_bestseller %}<span class="pbadge bestseller"><i class="bi bi-fire"></i> Bestseller</span>{% endif %}
                      {% if product.discount_percentage %}<span class="pbadge discount">-{{ product.discount_percentage }}% Off</span>{% endif %}
                      {% if product.stock_quantity <= 0 %}<span class="pbadge out-of-stock">Out of Stock</span>{% endif %}
                    </div>

                    <!-- Quick actions -->
                    <div class="product-actions">
                      <button class="action-btn wishlist-btn" title="Add to wishlist" data-id="{{ product.id }}">
                        <i class="bi bi-heart"></i>
                      </button>
                      <a href="{{ product.get_absolute_url }}" class="action-btn" title="Quick view">
                        <i class="bi bi-eye"></i>
                      </a>
                    </div>
                  </div>

                  <!-- Body -->
                  <div class="card-body">
                    {% if product.category %}
                    <div class="product-category">{{ product.category.name }}</div>
                    {% endif %}

                    <h3 class="card-title">
                      <a href="{{ product.get_absolute_url }}">{{ product.name }}</a>
                    </h3>

                    {% if product.short_description %}
                    <p class="product-description">{{ product.short_description }}</p>
                    {% endif %}

                    <!-- Stars -->
                    {% if product.average_rating %}
                    <div class="star-rating">
                      <div class="stars">
                        {% for i in "12345" %}
                        <i class="bi bi-star{% if forloop.counter <= product.average_rating|floatformat:0|add:0 %}-fill{% elif forloop.counter <= product.average_rating|add:0.5 %}-half{% else %} empty{% endif %}"></i>
                        {% endfor %}
                      </div>
                      <span class="rating-text">({{ product.review_count|default:0 }})</span>
                    </div>
                    {% endif %}

                    <!-- Price -->
                    <div class="price-section">
                      <div>
                        {% if product.original_price %}
                        <span class="original-price">₦{{ product.original_price|intcomma }}</span>
                        {% endif %}
                        <span class="current-price">₦{{ product.price|intcomma }}</span>
                      </div>
                      {% if product.discount_percentage %}
                      <span class="discount-pill">-{{ product.discount_percentage }}%</span>
                      {% endif %}
                    </div>

                    <!-- Cart button -->
                    <form method="post" action="{% url 'shop:add_to_cart' product.id %}">
                      {% csrf_token %}
                      <button type="submit" class="cart-btn" {% if product.stock_quantity <= 0 %}disabled{% endif %}>
                        {% if product.stock_quantity <= 0 %}
                        <i class="bi bi-x-circle"></i> Out of Stock
                        {% else %}
                        <i class="bi bi-bag-plus"></i> Add to Cart
                        {% endif %}
                      </button>
                    </form>
                  </div>
                </div>
              </div>
              {% empty %}
              <div class="col-12">
                <div class="shop-empty">
                  <div class="shop-empty-icon"><i class="bi bi-bag-x"></i></div>
                  <h3>No Products Found</h3>
                  <p>We couldn't find products matching your criteria. Try adjusting your filters.</p>
                  <a href="{% url 'shop:product_list' %}" class="cart-btn d-inline-flex mt-4" style="width:auto;padding:12px 28px;margin-top:20px;">
                    <i class="bi bi-grid-3x3-gap"></i> Browse All Products
                  </a>
                </div>
              </div>
              {% endfor %}
            </div>
          </div>

          <!-- ---- LIST VIEW ---- -->
          <div class="products-list" id="viewList">
            {% for product in products %}
            <div class="product-list-item">
              <div class="row g-0 align-items-stretch">
                <div class="col-md-4">
                  <div class="product-image-wrapper" style="height:100%;min-height:200px;border-radius:0;">
                    {% if product.image %}
                    <img src="{{ product.image.url }}" alt="{{ product.name }}" style="height:100%;min-height:200px;" loading="lazy">
                    {% else %}
                    <div class="img-placeholder" style="min-height:200px;"><i class="bi bi-bag"></i></div>
                    {% endif %}
                    <div class="product-badges">
                      {% if product.is_featured %}<span class="pbadge featured"><i class="bi bi-star-fill"></i> Featured</span>{% endif %}
                      {% if product.discount_percentage %}<span class="pbadge discount">-{{ product.discount_percentage }}%</span>{% endif %}
                    </div>
                  </div>
                </div>
                <div class="col-md-8">
                  <div class="card-body" style="padding:26px 28px;display:flex;flex-direction:column;height:100%;">
                    {% if product.category %}<div class="product-category">{{ product.category.name }}</div>{% endif %}
                    <h3 class="card-title" style="font-size:1.15rem;">
                      <a href="{{ product.get_absolute_url }}">{{ product.name }}</a>
                    </h3>
                    {% if product.short_description %}
                    <p class="product-description" style="-webkit-line-clamp:3;">{{ product.short_description }}</p>
                    {% endif %}
                    <div style="display:flex;align-items:center;justify-content:space-between;gap:16px;margin-top:auto;flex-wrap:wrap;">
                      <div class="current-price" style="font-size:1.6rem;">₦{{ product.price|intcomma }}</div>
                      <div style="display:flex;gap:10px;align-items:center;">
                        <a href="{{ product.get_absolute_url }}" class="cart-btn" style="padding:10px 20px;font-size:0.8rem;width:auto;">
                          <i class="bi bi-eye"></i> View
                        </a>
                        <form method="post" action="{% url 'shop:add_to_cart' product.id %}">
                          {% csrf_token %}
                          <button type="submit" class="cart-btn" style="padding:10px 20px;font-size:0.8rem;" {% if product.stock_quantity <= 0 %}disabled{% endif %}>
                            <i class="bi bi-bag-plus"></i> Add to Cart
                          </button>
                        </form>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            {% empty %}
            <div class="shop-empty">
              <div class="shop-empty-icon"><i class="bi bi-bag-x"></i></div>
              <h3>No Products Available</h3>
              <p>Check back soon for new arrivals.</p>
            </div>
            {% endfor %}
          </div>

          <!-- ---- PAGINATION ---- -->
          {% if is_paginated %}
          <div class="shop-pagination">
            <ul class="pagination">
              {% if page_obj.has_previous %}
              <li class="page-item">
                <a class="page-link" href="?page={{ page_obj.previous_page_number }}{% if request.GET.q %}&q={{ request.GET.q }}{% endif %}{% if request.GET.category %}&category={{ request.GET.category }}{% endif %}{% if request.GET.sort %}&sort={{ request.GET.sort }}{% endif %}">
                  <i class="bi bi-chevron-left"></i>
                </a>
              </li>
              {% else %}
              <li class="page-item disabled"><span class="page-link"><i class="bi bi-chevron-left"></i></span></li>
              {% endif %}

              {% for num in page_obj.paginator.page_range %}
              {% if page_obj.number == num %}
              <li class="page-item active"><a class="page-link" href="#">{{ num }}</a></li>
              {% elif num > page_obj.number|add:'-3' and num < page_obj.number|add:'3' %}
              <li class="page-item">
                <a class="page-link" href="?page={{ num }}{% if request.GET.q %}&q={{ request.GET.q }}{% endif %}{% if request.GET.category %}&category={{ request.GET.category }}{% endif %}{% if request.GET.sort %}&sort={{ request.GET.sort }}{% endif %}">{{ num }}</a>
              </li>
              {% endif %}
              {% endfor %}

              {% if page_obj.has_next %}
              <li class="page-item">
                <a class="page-link" href="?page={{ page_obj.next_page_number }}{% if request.GET.q %}&q={{ request.GET.q }}{% endif %}{% if request.GET.category %}&category={{ request.GET.category }}{% endif %}{% if request.GET.sort %}&sort={{ request.GET.sort }}{% endif %}">
                  <i class="bi bi-chevron-right"></i>
                </a>
              </li>
              {% else %}
              <li class="page-item disabled"><span class="page-link"><i class="bi bi-chevron-right"></i></span></li>
              {% endif %}
            </ul>
          </div>
          {% endif %}

        </div>
      </div>
    </div>
  </section>

</main>

<style>
.cat-link:hover {
  background: rgba(201,168,76,0.07) !important;
  border-color: rgba(201,168,76,0.15) !important;
  color: var(--gold-light) !important;
  transform: translateX(4px);
}
</style>
{% endblock %}

{% block extra_scripts %}
<script>
// ---- View toggle
(function () {
  const grid = document.getElementById('viewGrid');
  const list = document.getElementById('viewList');
  document.querySelectorAll('.view-btn').forEach(btn => {
    btn.addEventListener('click', () => {
      document.querySelectorAll('.view-btn').forEach(b => b.classList.remove('active'));
      btn.classList.add('active');
      if (btn.dataset.view === 'grid') {
        grid.classList.add('active'); list.classList.remove('active');
        grid.style.display = ''; list.style.display = 'none';
      } else {
        list.classList.add('active'); grid.classList.remove('active');
        list.style.display = ''; grid.style.display = 'none';
      }
    });
  });
})();

// ---- 3D tilt
document.querySelectorAll('.product-card').forEach(card => {
  card.addEventListener('mousemove', e => {
    const r = card.getBoundingClientRect();
    const x = ((e.clientX - r.left) / r.width  - 0.5) * 8;
    const y = ((e.clientY - r.top)  / r.height - 0.5) * -8;
    card.style.transform = `translateY(-10px) rotateX(${y}deg) rotateY(${x}deg)`;
    card.style.transition = 'transform 0.1s ease';
  });
  card.addEventListener('mouseleave', () => {
    card.style.transform = '';
    card.style.transition = 'all 0.45s cubic-bezier(0.175, 0.885, 0.32, 1.275)';
  });
});

// ---- Wishlist toggle
document.querySelectorAll('.wishlist-btn').forEach(btn => {
  btn.addEventListener('click', () => {
    btn.classList.toggle('wishlisted');
    const icon = btn.querySelector('i');
    icon.classList.toggle('bi-heart');
    icon.classList.toggle('bi-heart-fill');
  });
});
</script>
{% endblock %}